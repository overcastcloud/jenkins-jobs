- job:
    name: jenkins-jobs
    scm:
      - git:
          url: https://github.com/overcastde/jenkins-jobs
          branch: master

    triggers:
      - pollscm: "* * * * *"

- job-template:
    name: "{name}-upstream-master"
    scm:
      - git:
          url: "https://github.com/openstack/{name}"
          branch: master

    triggers:
      - pollscm: "H/15 * * * *"

    builders:
      - shell: |
          #!/bin/bash
          virtualenv venv
          . venv/bin/activate
          pip install tox
          tox -e py27

- project:
    name: nova
    jobs:
      - "{name}-upstream-master"

- project:
    name: glance
    jobs:
      - "{name}-upstream-master"

- project:
    name: keystone
    jobs:
      - "{name}-upstream-master"

- project:
    name: cinder
    jobs:
      - "{name}-upstream-master"

- job:
    name: contrail
    scm:
      - repo:
          manifest-url: https://github.com/overcastde/contrail-vnc
          manifest-file: noauth.xml

    triggers:
      - pollscm: "H/15 * * * *"

    builders:
      - shell: |
          #!/bin/bash -xe
          pip install lxml
          cd third_party
          USER=jenkins python fetch_packages.py
          cd ..
          rm -rf build/packages/*
          USER=jenkins make -f packages.make VERSION=${BUILD_NUMBER} source-package-contrail source-package-ifmap-server source-package-neutron-plugin-contrail source-package-contrail-web-controller source-package-contrail-web-core
          cd build/packages
          for x in *.dsc; do sbuild -n -d trusty -A ${x} || true; done

- job:
    name: schmenkins
    scm:
      - git:
          url: https://github.com/Linux2Go/schmenkins.git

    triggers:
      - pollscm: "* * * * *"

    builders:
      - shell: |
         #!/bin/bash
         virtualenv venv
         . venv/bin/activate
         pip install -r requirements.txt -r test-requirements.txt
         python setup.py install
         nosetests -v .
      - shell: |
         #!/bin/bash
         python setup.py install
